# ESP32-S3 模块化管理系统

本项目旨在为 `ESP32-S3 (N8R8)` 开发一个高效、模块化的嵌入式管理系统。系统充分利用了ESP32-S3的双核、8MB Octal PSRAM及8MB Quad Flash等硬件资源，并通过PlatformIO + Arduino框架进行开发。

该系统包含一个基于 `ESPAsyncWebServer` 和 `WebSocket` 的响应式Web UI，允许用户通过浏览器实时监控设备状态、配置系统参数。

## 核心特性

- **硬件优化:**
  - **双核利用:** 核心任务分离，Core 0处理密集型任务（预留给摄像头），Core 1处理网络与UI交互。
  - **PSRAM管理:** 通过自定义内存管理器 `Sys_MemoryManager` 实现内存池，避免内存碎片。
  - **8MB Flash:** 使用自定义分区表 `my_8MB.csv`，同时支持 `LittleFS` (用于Web UI资源) 和 `FFat` (用于大文件)。
- **软件架构:**
  - **模块化设计:** 各核心功能（WiFi, WebServer, 文件系统, 设置管理, 任务调度）均封装为独立的单例类。
  - **FreeRTOS 任务化:** 系统运行于FreeRTOS之上，通过任务和队列实现异步非阻塞操作。
  - **Web UI:** 基于Bootstrap 5和Vanilla JavaScript，通过WebSocket与后端实时通信，实现数据驱动的UI更新。
  - **前端资源优化:** 通过Python脚本在编译时自动对 `data` 目录下的Web资源进行Minify和Gzip压缩，提升加载速度。

## 当前开发状态 (阶段1完成)

项目已完成基础框架的搭建和验证，达到了 **“阶段1：Web服务器与前端资源流水线”** 的目标。

- **[✔] 硬件验证:** `main.cpp` 中的诊断代码已确认PSRAM、Flash分区等硬件工作正常。
- **[✔] 核心服务:** 内存管理器、文件系统管理器、WiFi管理器、Web服务器等核心模块已初步实现。
- **[✔] Web服务:** ESPAsyncWebServer已启动，能够提供`data`目录下的静态文件。
- **[✔] 前端流水线:** `minify_gzip.py` 脚本可正常工作，浏览器访问时资源以gzip格式加载。
- **[✔] 实时通信:** WebSocket连接已建立，前端可通过JSON命令与后端进行基本的双向通信。
- **[✔] 基础UI:** 已实现一个基础的仪表盘和设备控制页面，可通过左侧导航栏切换。

## 待办与优化项

在进入下一阶段开发前，识别出以下可优化的设计点：

1.  **[待优化] WiFi连接逻辑:** 当前WiFi连接过程在 `setup()` 中是阻塞式的，应改为在后台任务中进行非阻塞连接，避免影响系统启动速度和稳定性。
2.  **[待优化] UI交互体验:**
    -   危险操作（如重启）的二次确认应从简单的 `confirm()` 升级为体验更好的Bootstrap Modal。
    -   移动端打开侧边栏导航后，点击链接应自动关闭侧边栏。
3.  **[待统一] WiFi配网方案:** `platformio.ini` 中配置了ESP-IDF的标准化配网组件，但代码中为手动实现，两者存在不一致。
4.  **[待完善] 日志系统:** 设计文档中规划的日志重定向到前端的功能已初步实现，但可以进一步完善日志级别过滤和格式化。

## 如何开始

1.  **硬件:** ESP32-S3开发板 (N8R8 - 8MB Flash, 8MB PSRAM)。
2.  **软件:** VS Code + PlatformIO 插件。
3.  **配置:**
    -   克隆本项目。
    -   根据您的硬件连接，修改 `platformio.ini` 中的 `upload_port` 和 `monitor_port`。
4.  **编译与上传:**
    -   **首次上传或更新Web UI:**
        ```shell
        platformio run -t upload -t uploadfs
        ```
    -   **仅上传固件:**
        ```shell
        platformio run -t upload
        ```
5.  **访问:**
    -   通过串口监视器查看设备IP地址。
    -   在浏览器中打开 `http://<设备IP地址>`。

## 下一阶段计划 (阶段2)

接下来，项目将正式进入 **“阶段2：完善Web服务模块”** 的开发，主要包括：

- **仪表盘 (Dashboard):**
  - 实现所有系统信息的动态刷新。
  - 完成重启、恢复出厂设置等全局操作的后端逻辑及前端交互（使用Modal）。
- **设备控制 (Settings):**
  - **WiFi设置:**
    - 实现完整的WiFi模式切换、SSID扫描、密码设置、静态IP配置等功能。
    - 实现配置的NVS持久化保存与加载。
  - **蓝牙设置:**
    - 实现蓝牙的启用/禁用和设备名称修改。
  - **其他模块:** 为后续的摄像头、OTA等模块预留UI和后端接口。